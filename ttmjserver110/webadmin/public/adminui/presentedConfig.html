<html>
	<head>
		<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="../easyui/themes/default/easyui.css">
		<link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css">
		<script type="text/javascript" src="../easyui/jquery.min.js"></script>
		<script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="../share.js"></script>
		<title>赠送配置</title>
	</head>
	<body class="easyui-layout">
		<div id="addPresented" class="easyui-dialog"  closed="true" title="充值修改" style="width:400px;height:400px;"
		 data-options="iconCls:'icon-save',resizable:true,modal:true">
		<table width="100%">
			<tr><td><label>Id:</label></td> <td><label id="id">0</label></td></tr>
			<!--<tr><td><label>类别:</label></td> <td><input class="easyui-validatebox" type="text" id="type" data-options="required:true" /></td></tr>-->
			<tr><td><label>赠送金币:</label></td> <td><input class="easyui-validatebox" type="text" id="count" data-options="required:true" /></td></tr>
			<tr><td><label>触发条件:</label></td> <td><input class="easyui-validatebox" type="text" id="limit" data-options="required:true" /></td></tr>

		</table>
		<a href="#" class="easyui-linkbutton" onclick="editPresentedYes()">确定</a>
	</div>
		<div>
		<a href="#" class="easyui-linkbutton" onclick="showCfg()">刷新</a>
		<a href="#" class="easyui-linkbutton" onclick="addPresented()">添加</a>
		<a href="#" class="easyui-linkbutton" onclick="editPresented()">修改</a>
		<a href="#" class="easyui-linkbutton" onclick="deletePresented()">删除</a>
	</div>
	<table  id="dg" class="easyui-datagrid" title="Basic DataGrid" style="width:100%;height:80%"
			data-options="singleSelect:true,collapsible:true,
				method:'get',
				remoteSort:false,
				multiSort:true,
				rownumbers:true,
				singleSelect:true,
				autoRowHeight:false
            ">
		<thead>
		<tr>
			<th data-options="field:'id',width:80,sortable:true">id</th>
		<!--	<th data-options="field:'once',width:80,sortable:true">类别</th>-->
			<th data-options="field:'count',width:80,sortable:true">第一次</th>
			<th data-options="field:'limit',sortable:true">触发条件</th>

		</tr>
		</thead>
	</table>
		<script type="text/javascript">
		   		var data_ = {};
		var addId = 0;
		//TODO添加充值的保存url、字段需要修改		
		function savepresentedData(msg){
			postJson("/redisData/savepresentedDataJson",{msg:{type:"content", content:msg}},
				function(data)
				{
					if(data > 0){
						alert("修改成功");
						showCfgCommon();
					}
				}
			);
		}
		function deletePresented(){
			var alipay = $("#dg").datagrid("getSelected");
			if(alipay){
				var id = alipay.id;

				if(window.confirm("删除，请确认?")) {
					postJson("/redisData/delpresentedDataJson", {msg:id.toString()}, function(data) {

						data_ = data;

						showCfgCommon();
					});
				}
			}
			else {
				alert("请选择删除条目");
			}
		}
		function editPresented(){
			var itemSelected = $("#dg").datagrid("getSelected");
			if(itemSelected){
				//document.getElementById("id").style.display = "none";

				$("#id").html(itemSelected.id);

				$('#count').val(itemSelected.count);
				$('#limit').val(itemSelected.limit);

				$('#addPresented').dialog('open');
			}
			else {
				alert("请选择条目");
			}
		}



		function editPresentedYes(){
			//id:parseInt($('#id').val())
			var idlabel = document.getElementById("id").innerHTML;
			var msg={
				id:parseInt(idlabel),
				count:parseInt($('#count').val()),
				limit:parseInt($('#limit').val()),

			};

			if(msg.count === void 0 || msg.count == null || isNaN(msg.count) || msg.count <= 0) {
				alert("无效金币数量");
				return;
			}

			else if(msg.limit === void 0 || msg.limit == null || isNaN(msg.limit) || msg.limit < 0) {
				alert("无效值");
				return;
			}

			var itemInfo = {};
			var obj = {"count":msg.count,"limit":msg.limit};
			data_[msg.id] = obj;
			itemInfo["id"] = msg.id;
			itemInfo["content"] = obj;

			savepresentedData(itemInfo);

			$('#addPresented').dialog('close');
		}


		function getAddId(){
			return (addId + 1).toString();
		}

		function addPresented(){
			$("#id").html(getAddId());

			$('#count').val("");
			$('#limit').val("");
			
			$('#addPresented').dialog('open');
		}
        //添加到table中 		
		function showCfgCommon(){
			addId = 0;

			var result = [];

				var cell = {};
				cell["id"] = 0;
				cell["count"] = resluts.count;
				cell["limit"] = resluts.limit;

				result.push(cell);

			var da = {};
			da["total"] = result.length;
			da["rows"] = result;


			$("#dg").datagrid("loadData", da);
			if(da.total==0||da==""||!da){
				$('#dg').datagrid('appendRow',{id:"没有数据", once:"", touchCondition:"", second:"",giveNum:""});
			}
		}

		var resluts =[];
		function showCfg(){
			postJson("/redisData/getpresentedDataJson",{msg:"content"},
				function(data) {
					if(!data){
						$('#dg').datagrid('appendRow',{id:"没有数据", once:"", touchCondition:"", second:"",giveNum:""});
						return;
					}
					data_ = data;

					//console.log(data);

					resluts =JSON.parse(data_['data']);
					//	resluts[i] =JSON.parse(data_['data'][i]);

					showCfgCommon();
				}
			);
		}
		$(document).ready(function () {
			 showCfg();

		});
		</script>
	</body>
</html>