<html>

<head>
    <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/icon.css">
    <script type="text/javascript" src="/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/share.js"></script>
</head>

<body  class="easyui-layout">
	<div style="margin:2px 0;">
		<a href="#" class="easyui-linkbutton" onclick="getAlipayOrders()">刷新</a>
	</div>
	<table  id="dg" class="easyui-datagrid" title="Basic DataGrid" style="width:100%;height:80%"
			data-options="singleSelect:true,collapsible:true,
			method:'get',
			remoteSort:false,
			multiSort:true,
			rownumbers:true,
			singleSelect:true,
			autoRowHeight:false
		">
		<thead>
		<tr>
			<th data-options="field:'orderNumber',width:80">Number</th>
			<th data-options="field:'state',width:200">State</th>
			<th data-options="field:'geTime',width:200,align:'center'">Time</th>
		</tr>
		</thead>
	</table>
    <script type="text/javascript">
		function getAlipayOrders() {
			loadData();
		}
		
		function loadData() {
			postJson("/admin/getAliPayMsg",{},
				function(data)
				{
					var result = [];
					var data_ = {};
					data_.rows = result;

					for(var key in data){
						//711135 2016 07 15 11 11 06 3679009
						var number = "";
						for(var i = 0; i < key.length; i++){
							number += key[i];
							if(i == 5 || i == 19){
								number += " , ";
							}
							else if(i == 9 || i == 11){
								number += "-";
							}
							else if(i == 13){
								number += " ";
							}
							else if(i == 15 || i == 17){
								number += ":";
							}
						}

						var ob = {};
						ob["orderNumber"] = number;
						for(var ke in data[key]){
							if(ke == "geTime"){
								ob[ke] = getDateCommonFormat(new Date(data[key][ke]));
							}
							else {
								ob[ke] = data[key][ke];
							}
							//ob[ke] = data[key][ke];
						}
						result.push(ob);
					}

					$("#dg").datagrid("loadData", data_);

					//setTimeout("loadData()", 2000);
				}
			);
		}

//		setTimeout(function () {
//			alert("aaaaaaaaaaaaaa");
//			loadData();
//		},2000);

		$(document).ready(function () {
			loadData();
		});
	</script>

</body>
</html>