<html>

<head>
	<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="/easyui/themes/icon.css">
	<script type="text/javascript" src="/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/share.js"></script>
</head>

<body  class="easyui-layout">
<a href="#" class="easyui-linkbutton" onclick="getOnlineReport()">刷新</a>
<table  id="tt" class="easyui-datagrid" title="Basic DataGrid" style="width:100%;height:95%"
		data-options="singleSelect:true,collapsible:true">
</table>

<script type="text/javascript">
	var myview = $.extend({},$.fn.datagrid.defaults.view,{
		onAfterRender:function(target){
			$.fn.datagrid.defaults.view.onAfterRender.call(this,target);
			var opts = $(target).datagrid('options');
			var vc = $(target).datagrid('getPanel').children('div.datagrid-view');
			vc.children('div.datagrid-empty').remove();
			if (!$(target).datagrid('getRows').length){
				var d = $('<div class="datagrid-empty"></div>').html(opts.emptyMsg || 'no records').appendTo(vc);
				d.css({
					position:'absolute',
					left:0,
					top:50,
					width:'100%',
					textAlign:'center'
				});
			}
		}
	});
	function getOnlineReport() {
		postJson("/admin/onlineReport", {}, function (data) {
			if(!data) {
				alert('没有数据');
				return;
			}

			var result = [];

			result.push({field: 'id', title: 'ID', width: 100});
			result.push({field: 'online', title: '在线', width: 100});
			result.push({field: 'vipTable', title: '房间', width: 100});

			var dd = {};
			dd.id = 1;
			dd.online = 1;
			dd.vipTable = 1;

			var total = {id: '合计', online: 0, vipTable: 0};

			for (var i = 0; i < data.length; i++) {
				for (var key in data[i]) {
					if (!dd[key]) {
						dd[key] = 1;
						result.push({field: key, title: key, width: 100});
						total[key] = data[i][key];
					} else if (key != 'id') {
						total[key] += data[i][key];
					}
				}
			}

						$('#tt').datagrid({
							columns:[result]
						});

						data.push(total);
					//	$("#tt").datagrid("loadData", {rows : data});
						$('#tt').datagrid({
							data: data,
							view: myview,
							emptyMsg: '没有数据'
						});
					}
			);
		}

		$(document).ready(function(){
			getOnlineReport();
		});
	</script>

</body>
</html>