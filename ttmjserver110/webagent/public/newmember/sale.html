<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cmn-Hans">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <title>出售界面</title>
    <link rel="stylesheet" href="../newcss/reset.css">
    <link href="../bootstrap/css/bootstrap.min.css" title="" rel="stylesheet" />
    <link title="" href="../newcss/style.css" rel="stylesheet" type="text/css"  />
    <link title="blue" href="../newcss/dermadefault.css" rel="stylesheet" type="text/css"/>
    <link href="../newcss/templatecss.css" rel="stylesheet" title="" type="text/css" />
    <link rel="stylesheet" href="../newcss/magic-check.css">
    <link rel="stylesheet" href="../newcss/dialog.css">
</head>
<body>
<div class="alert alert-info alert-dismissable" role="alert">
    <button class="close" type="button" onclick="$('.alert').eq(0).hide();">&times;</button>
    <span></span>
</div>
<nav class="nav navbar-default navbar-mystyle navbar-fixed-top">
    <div class="navbar-header">
        <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand mystyle-brand"><span class="glyphicon glyphicon-tag"></span></a></div>
    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav pull-right">
            <li class="dropdown li-border"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown"><span id="userNick">3179923507@qq.com</span><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#" id="logout">退出</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
<div class="down-main">
    <div class="left-main left-off">
        <div class="sidebar-fold"><span class="glyphicon glyphicon-menu-hamburger"></span></div>
        <div class="subNavBox">
            <div class="sBox">
                <ul class="navContent" style="display:block">
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />首页</div>
                        <a href="index.html"><span class="sublist-icon glyphicon glyphicon-home"></span><span class="sub-title">首页</span></a></li>
                    <li class="active">
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />出售</div>
                        <a href="sale.html"><span class="sublist-icon glyphicon glyphicon-tag"></span><span class="sub-title">出售</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />充值</div>
                        <a href="charge.html"><span class="sublist-icon glyphicon glyphicon-shopping-cart"></span><span class="sub-title">充值</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />充值记录</div>
                        <a href="rechargerecord.html"><span class="sublist-icon glyphicon glyphicon-time"></span><span class="sub-title">充值记录</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />出售记录</div>
                        <a href="salerecord.html"><span class="sublist-icon glyphicon glyphicon-star-empty"></span><span class="sub-title">出售记录</span></a></li>
                    <li id="addMember">
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />添加会员</div>
                        <a href="addmember.html"><span class="sublist-icon glyphicon glyphicon-plus"></span><span class="sub-title">添加会员</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />我的会员</div>
                        <a href="recommand.html"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">我的会员</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />设置</div>
                        <a href="set.html"><span class="sublist-icon glyphicon glyphicon-cog"></span><span class="sub-title">会员中心</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="right-product view-product right-off">
        <div class="container-fluid">
            <div class="manage account-manage info-center">
                <div class="page-header">
                    <div class="pull-left">
                        <h4>出售<small id="gameName"></small></h4>
                    </div>
                </div>
                <dl class="account-basic clearfix">
                    <dt class="pull-left searchMem">
                        <div class="input-group">
                            <input type="text" class="form-control" id="uid">
                             <span class="input-group-btn">
                               <button type="button" class="btn btn-default searchbtn"><span class="glyphicon glyphicon-search"></span>搜索</button>
                            </span>
                        </div>
                    </dt>
                    <dd class="pull-left margin-large-left margin-small-top">
                        <p class="text-small">
                           1.输入玩家用户ID
                        </p>
                        <p class="text-small">
                           2.搜索玩家
                        </p>
                        <p class="text-small">
                            3.添加钻石
                        </p>
                        <!--<img src="" alt="用户头像" class="userImgPor"/>-->
                    </dd>
                </dl>
                <div class="saleaccountBox">
                    <div class="userImgPorBox">
                        <img src="../img/userPor.png" alt="用户头像" class="userImgPor"/>
                    </div>
                    <ul class="saleaccount">
                        <li class="clearfix">
                            <img src="./../img/user.png" alt="用户头像">
                            <span class="userName">用户名不得超过十个字</span>
                        </li>
                        <li>
                            <img src="./../img/phone.png" alt="用户ID">
                             <span class="userID">***********</span>
                        </li>
                        <li>
                            <img src="./../img/diamond.png" alt="钻石数量">
                            <span class="userDia">500</span>
                        </li>
                        <li>
                            <a href="#" class="addDia btn btn-primary" role="button" id="addDiaBtn">添加钻石</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
    <div id="addDia" class="modalBox">
        <div class="modalHeader">
            <button type="button" class="closeModal closeFunc">×</button>
            <h4 class="modalTitle">售卖钻石</h4>
        </div>
        <div class="modalBody">
            <div class="opt pull-left col-md-3 col-md-offset-3 col-xs-5 col-xs-offset-1">
                <input class="magic-radio" type="radio" name="radio" id="r1" value="1" checked>
                <label for="r1">售卖</label>
            </div>
            <div class="opt pull-left col-md-3 col-md-offset-3 col-xs-5 col-xs-offset-1">
                <input class="magic-radio" type="radio" name="radio" id="r2" value="0">
                <label for="r2">赠送</label>
            </div>
            <p class="row"><span class="pull-left col-md-3 col-md-offset-3 col-xs-3">数量:</span><input class="col-md-5 col-xs-6 pull-left" type="text" id="buyNum" required><span class="col-xs-3 col-md-1"></span></p>
            <p class="row"><span class="pull-left col-md-3 col-md-offset-3 col-xs-3">金额:</span><input class="col-md-5 col-xs-6 pull-left" type="text" id="buyMoney" value="0" required><span class="col-xs-3 col-md-1"></span></p>
            <p class="row"><span class="pull-left col-md-3 col-md-offset-3 col-xs-3">备注:</span><input class="col-md-5 col-xs-6 pull-left" type="text" id="buyNote"><span class="col-xs-3 col-md-1"></span></p>
        </div>
        <div class="modalFooter">
            <button type="button" data-dismiss="modal" class="btn btn-default cancelbutton closeFunc">取消</button>
            <button type="button" class="btn btn-primary" id="submit">确定</button>
        </div>
    </div>
    <div class="coverWhite">
    </div>
<script src="../script/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="../bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../script/slidemenu.js"></script>
<script src="../script/dialog.js"></script>
<script src="../share.js"></script>
<script type="text/javascript">
    $(function(){
        $("#gameName").html(getGameType(window.location.host).agentname);
        menuShow();
        function menuShow()
        {
            postJson("/admin/getMyInfo",{msg:"content"},function(rtn) {
                $("#userNick").html(rtn.mName);
                if (rtn) {
                    if (rtn.adminLevel == 2 || rtn.adminLevel == '2') {
                        $("#addMember").css("display", "block");
                    }
                };
            })
        }
        // 输入用户ID后搜索
        $(".searchbtn").eq(0).click(function(e){
            e.preventDefault();
            getUserByID();
        });
        function getUserByID(){
            var uid = parseInt($("#uid").val());
            if (uid > 10000) {
                postJson("/admin/getUserByID", {uid: uid},
                        function(data) {
                            if (data.rows.length > 0){
                                //注册时间格式调整
                                for(var key in data.rows)
                                {
                                    var time = data.rows[key]["sendTime"];
                                    time = new Date(time);
                                    //time = time.toLocaleDateString() + " " + time.toLocaleTimeString();
                                    time = getDateCommonFormat(time);
                                    data.rows[key]["sendTime"] = time;
                                }
                                user = data.rows[0];
                                if (!user) {
                                    $(".alert").eq(0).alertModal('用户不存在',2000);
                                }
                                else {
                                    $(".userName").eq(0).html( unescape(user.nickname));
                                    $(".userID").eq(0).html(user.uid);
                                    $(".userDia").eq(0).html(user.money);
                                    $(".saleaccountBox").eq(0).css("display","block");
                                    $(".userImgPor").eq(0).attr("src",user.headimgurl);
                                    console.log(user.headimgurl);
                                }
                            }else {
                                $(".alert").eq(0).alertModal('用户不存在',2000);
                            };
                        })
            } else {
                $(".alert").eq(0).alertModal('请输入用户ID',2000);
            };
        }
//        var lastClickTime1=null;
        // 售卖对话框点击确定按钮触发的事件
        function buyDiamond(msg){
            postJson("/admin/addUserMoney", msg, function(data){
                $('#submit').removeAttr("disabled");
                if (data >= 0) {
                    alert("添加成功");
                    getUserByID();
                    $(".coverWhite").eq(0).css("display","none");
                    $(".modalBox").eq(0).css("display","none");
                }else if(data == -1){
                    alert("请在5s后操作");
                    $('#submit').attr("disabled",true);
                    setTimeout(function(){
                        $('#submit').removeAttr("disabled");
                    },3000);
                } else if(data==-2){
                    alert("余额不足");
                    $(".coverWhite").eq(0).css("display","none");
                    $(".modalBox").eq(0).css("display","none");
                }else if(data==-3){
                    alert("信息错误");
                    $(".coverWhite").eq(0).css("display","none");
                    $(".modalBox").eq(0).css("display","none");
                } else if(data==-4){
                    alert("id错误");
                    $(".coverWhite").eq(0).css("display","none");
                    $(".modalBox").eq(0).css("display","none");
                }else if(data == -10){
                    alert("您的密码不安全，请修改密码后操作");
                    $(".coverWhite").eq(0).css("display","none");
                    $(".modalBox").eq(0).css("display","none");
                }
            });
        }
        $("#submit").click(function(e) {
            e.preventDefault();
            var msg = {
                uid:user.uid,
                buyNum: parseInt($('#buyNum').val()),
                buyMoney: parseInt($('#buyMoney').val()),
                buyNote: $('#buyNote').val(),
                buyType: $("input[type='radio']:checked").val()
            };
            if (msg.buyNum > 0 && msg.buyMoney >= 0) {
                $('#submit').attr("disabled",true);
                if (msg.buyNum > 500) {
                    $(".coverWhite").eq(0).css("display", "none");
                    $(".modalBox").eq(0).css("display", "none");
                    $.dialog.confirm("确定要给<span style='color:red'>" + msg.uid + "</span>充值<span style='color:green'>" + msg.buyNum + "</span>个钻石吗?").onClose(function (response) {
                        if (response) {
                            buyDiamond(msg);
                        } else {
                            $('#submit').removeAttr("disabled");
                            $(".coverWhite").eq(0).css("display", "block");
                            $(".modalBox").eq(0).css("display", "block");
                            //$.dialog.alert("You clicked Cancel or pressed the Esc key.").autoClose(5000);
                        }
                    });
                }else if(msg.buyNum>0 && msg.buyNum<=500){
                    $('#submit').removeAttr("disabled");
                    buyDiamond(msg);
                }else if (msg.buyNum <= 0 || isNaN(msg.buyNum)) {
                    alert('请正确填写出售数量');
                    $('#submit').removeAttr("disabled");
                } else {
                    alert('请正确填写出售金额');
                    $('#submit').removeAttr("disabled");
                }
            }
        });
        var lastClickTime=null;
        // 点击添加钻石
        $("#addDiaBtn").click(function(e){
            e.preventDefault();
            var dd=new Date();
            if(lastClickTime && lastClickTime.getTime() && dd.getTime() - lastClickTime.getTime() <= 4 * 1000)
            {
                alert("请勿频繁操作");
                return;
            }
            lastClickTime = dd;
            $(".coverWhite").eq(0).css("display","block");
            $(".modalBox").eq(0).css("display","block");
            $('#buyNum').val("");
            $('#buyMoney').val("0");
            $('#buyNote').val("");
            $('#submit').removeAttr("disabled");
        });
        //点击关闭弹窗的功能
        $(".closeFunc").click(function(e){
            e.preventDefault();
            $(".coverWhite").eq(0).css("display","none");
            $(".modalBox").eq(0).css("display","none");
            $('#submit').removeAttr("disabled");
        });
        $("#logout").click(function(e){
            e.preventDefault();
            logout();
        })

    })
</script>
</body>
</html>
