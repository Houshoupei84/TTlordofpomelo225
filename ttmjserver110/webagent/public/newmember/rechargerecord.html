<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cmn-Hans">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <title>充值记录</title>
    <link rel="stylesheet" href="../newcss/reset.css">
    <link href="../bootstrap/css/bootstrap.min.css" title="" rel="stylesheet" />
    <link title="" href="../newcss/style.css" rel="stylesheet" type="text/css"  />
    <link title="blue" href="../newcss/dermadefault.css" rel="stylesheet" type="text/css"/>
    <link href="../newcss/templatecss.css" rel="stylesheet" title="" type="text/css" />
    <link rel="stylesheet" href="../newcss/jqpagination.css">
    <link rel="stylesheet" href="../newcss/daterangepicker.css">
</head>

<body>
<div class="alert alert-info alert-dismissable" role="alert">
    <button class="close" type="button" onclick="$('.alert').eq(0).hide();">&times;</button>
    <span></span>
</div>
<nav class="nav navbar-default navbar-mystyle navbar-fixed-top">
    <div class="navbar-header">
        <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand mystyle-brand"><span class="glyphicon glyphicon-time"></span></a></div>
    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav pull-right">
            <li class="dropdown li-border"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown"><span id="userNick">3179923507@qq.com</span><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#" id="logout">退出</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
<div class="down-main">
    <div class="left-main left-off">
        <div class="sidebar-fold"><span class="glyphicon glyphicon-menu-hamburger"></span></div>
        <div class="subNavBox">
            <div class="sBox">
                <ul class="navContent" style="display:block">
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />首页</div>
                        <a href="index.html"><span class="sublist-icon glyphicon glyphicon-home"></span><span class="sub-title">首页</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />出售</div>
                        <a href="sale.html"><span class="sublist-icon glyphicon glyphicon-tag"></span><span class="sub-title">出售</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />充值</div>
                        <a href="charge.html"><span class="sublist-icon glyphicon glyphicon-shopping-cart"></span><span class="sub-title">充值</span></a></li>
                    <li class="active">
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />充值记录</div>
                        <a href="rechargerecord.html"><span class="sublist-icon glyphicon glyphicon-time"></span><span class="sub-title">充值记录</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />出售记录</div>
                        <a href="salerecord.html"><span class="sublist-icon glyphicon glyphicon-star-empty"></span><span class="sub-title">出售记录</span></a></li>
                    <li id="addMember">
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />添加会员</div>
                        <a href="addmember.html"><span class="sublist-icon glyphicon glyphicon-plus"></span><span class="sub-title">添加会员</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />我的会员</div>
                        <a href="recommand.html"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">我的会员</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img src="../img/leftimg.png" />会员中心</div>
                        <a href="set.html"><span class="sublist-icon glyphicon glyphicon-cog"></span><span class="sub-title">会员中心</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="right-product right-off">
        <div class="container-fluid">
            <div class="info-center">
                <div class="page-header">
                    <div class="pull-left">
                        <h4>充值记录<small id="gameName"></small></h4>
                    </div>
                </div>
                <div class="search-box row">
                    <div class="col-md-4 demo">
                        <input type="text" id="config-demo" class="form-control" name="daterange">
                        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                    </div>
                </div>
                <div class="clearfix"></div>
                <p class="margin-big-tb text-sub text-default" id="illustration" style="display:none">
                  <span>总数量:</span><span id="numSum"></span><span>总金额:</span><span id="chargeSum"></span>
                </p>
                <div class="table-margin" id="dg">
                    <ul>
                        <li>类型</li>
                        <li>数量</li>
                        <li>金额</li>
                        <li>时间</li>
                    </ul>
                    <ul>
                        <li>赠送</li>
                        <li>1000</li>
                        <li>600</li>
                        <li>2015-06-03</li>
                    </ul>
                    <ul>
                        <li>赠送</li>
                        <li>1000</li>
                        <li>600</li>
                        <li>2015-06-03</li>
                    </ul>
                    <div class="pagination pull-right">
                        <a href="#" class="first" data-action="first">&laquo;</a>
                        <a href="#" class="previous" data-action="previous">&lsaquo;</a>
                        <input type="text" readonly="readonly" />
                        <a href="#" class="nextp" data-action="next">&rsaquo;</a>
                        <a href="#" class="lastp" data-action="last">&raquo;</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../script/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="../bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../script/jquery.jqpagination.min.js"></script>
<script src="../script/moment.min.js"></script>
<script src="../script/daterangepicker.js"></script>
<script src="../script/slidemenu.js"></script>
<script src="../share.js"></script>
<script type="text/javascript">
    $(function(){
        $("#gameName").html(getGameType(window.location.host).agentname);
        function menuShow()
        {
            postJson("/admin/getMyInfo",{msg:"content"},function(rtn) {
                $("#userNick").html(rtn.mName);
                if (rtn) {
                    if (rtn.adminLevel == 2 || rtn.adminLevel == '2') {
                        $("#addMember").css("display", "block");
                    }
                };
            })
        }
        menuShow();
        var startDate=getStrDate(new Date()).split("-").join("");
        query(0,startDate);
        //日历初始化
        $('input[name="daterange"]').daterangepicker({
            singleDatePicker: true,
            showDropdowns: true,
            format: 'YYYY-MM-DD',
            maxDate:new Date(),
            locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                fromLabel: '从',
                toLabel: '到',
                weekLabel: 'W',
                customRangeLabel: '选择时间',
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames: ["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],
            }
        }, function (start, end, label) {
            var dtArr =end.format('YYYY-MM-DD').split('-');
            startDate = dtArr.join("");
            query(0,startDate);
        });
        function query(pageNum,startDay) {
            postJson("/admin/getMemberBuyList1", {day: startDay}, function (dd) {
                $("#dg>ul:gt(0)").remove();
                var html = [];
                var numSum=0;
                var chargeSum=0;
                dd.rows = dd.rows.reverse();
                if (dd.rows.length == 0) {
                    html.push("<ul><li>没有数据!!!</li><li></li><li></li><li></li></ul>");
					$('.pagination').jqPagination({max_page:1});
                    $("#illustration").css("display","block");
                    $("#numSum").html(numSum);
                    $("#chargeSum").html(chargeSum);
                } else {
                    var buyRecord=dd.rows.length;
                    var total=Math.floor((buyRecord/10)+(buyRecord%10>0?1:0));
                    var showitems=(pageNum*10+10>buyRecord)?buyRecord:pageNum*10+10;
                    // 分页制作
                    $('.pagination').jqPagination({
                        max_page: total>0?total:1,
                        paged: function(page){
                            var pageNum=page-1;
                            query(pageNum,startDate);
                       }
                    });
                    for (var i = pageNum*10; i < showitems; i++) {
                        var time = dd.rows[i]["buyTime"];
                        time = new Date(time);
                        time = getDateCommonFormat(time);
                        dd.rows[i]["buyTime"] = time;
                        numSum+=dd.rows[i]["buyNum"];
                        chargeSum+=dd.rows[i]["buyMoney"];
                        html.push(getItem(dd.rows[i]));
                    }
                }
                function getItem(data) {
                    var time = data.buyTime;
                    var timeArr = time.split(/[\-:\s]/);
                    if (data.buyNote == "支付宝充值" || data.buyNote == "累计充值返利" || data.buyNote == "推荐返利") {
                        var tpl = "<ul><li>" + data.buyNote + "</li><li>" + data.buyNum + "</li><li>" + data.buyMoney + "</li><li>" + parseInt(timeArr[1]) + "/" + parseInt(timeArr[2]) + " " + parseInt(timeArr[3]) + ":" + timeArr[4] + "</li></ul>"
                    } else {
                        var tpl = "<ul><li>" + data.byMid + "</li><li>" + data.buyNum + "</li><li>" + data.buyMoney + "</li><li>" + parseInt(timeArr[1]) + "/" + parseInt(timeArr[2]) + " " + parseInt(timeArr[3]) + ":" + timeArr[4] + "</li></ul>"
                    }
                    return tpl;
                }
                $("#dg>ul").eq(0).after(html.join(""));
                $("#illustration").css("display","block");
                $("#numSum").html(numSum);
                $("#chargeSum").html(chargeSum);
            });
        };
        $("#logout").click(function(e){
            e.preventDefault();
            logout();
        })
    })
</script>
</body>
</html>
