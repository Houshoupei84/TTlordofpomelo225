<html>
<head>
    <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/icon.css">
    <script type="text/javascript" src="/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/share.js"></script>
	<title>出售记录</title>
</head>
<body  class="easyui-layout">
        <div>
			<input class="easyui-datebox" data-options="onSelect:onSelect" style = "width:150px"/>
			<a href="#" class="easyui-linkbutton" onclick="searchForTJData()">按日期搜索</a>
			<!--<a href="#" class="easyui-linkbutton" onclick="histroyData()">历史数据</a>-->
		</div>
        <table  id="dg" class="easyui-datagrid"  style="width:100%;height:80%"
            data-options="singleSelect:true,collapsible:true">
        <thead>
            <tr>
			    <th data-options="field:'uid',width:100">玩家ID</th>
                <th data-options="field:'buyNum',width:50">数量</th>
                <th data-options="field:'buyMoney',width:50">金额</th>
                <th data-options="field:'buyTime',width:150">时间</th>
                <th data-options="field:'money',width:50">余额</th>
                <th data-options="field:'userMoney',width:150">玩家余额</th>
            </tr>
        </thead>
    </table>
	<script type="text/javascript">
		var startDate;
		startDate = getFormatDate(new Date());
		startDate = startDate.toString();

	  function getMemberSellList()
	  {
		 postJson("/admin/getMemberSellList1",{"uid":100239, day:startDate},
		   function(data)
		   {
			   for(var key in data.rows){
				   var time = data.rows[key]["buyTime"];
				   time = new Date(time);
				   //time = time.toLocaleDateString() + " " + time.toLocaleTimeString();
				   time = getDateCommonFormat(time);
				   data.rows[key]["buyTime"] = time;
			   }

			   data.rows = data.rows.reverse();

		     $("#dg").datagrid("loadData",data);
		      var comTotal = {
			    uid:"合计",
				buyNum:compute("dg","buyNum"),
				buyMoney:compute("dg","buyMoney"),
				buyTime:"",
				userMoney:"",
				money:""
			   };
			   $("#dg").datagrid("appendRow",comTotal);
			   if(data.total==0||data==""||!data||data.rows.length==0){
//				   uid buyNum buyMoney buyTime money userMoney
				   $('#dg').datagrid('appendRow',{uid:"没有数据", buyNum:"", buyMoney:"", buyTime:"",userMoney:"",money:""});
			   }
		   }
		 );
	  }
		//减少服务器压力先注掉
	  //getMemberSellList();
	    function compute(tableName,colName) {
			var rows = $('#'+tableName).datagrid('getRows');
			var total = 0;
			for (var i = 0; i < rows.length; i++) {
				if(!rows[i][colName]){
					rows[i][colName]=0;
				}
				total += parseFloat(rows[i][colName]);
			}
			return total;
		}
	  function onSelect(date){
		  startDate = getFormatDate(date);
		  startDate = startDate.toString();
	  }

/*		function histroyData() {
			startDate = "";
			getMemberSellList();
		}*/

	  function searchForTJData(){//tongji
		  getMemberSellList();
	  }

	</script>

	
</body>
</html>